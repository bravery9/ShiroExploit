import common.SslUtils;

import java.io.BufferedReader;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.OutputStream;
import java.net.HttpURLConnection;
import java.net.InetSocketAddress;
import java.net.Proxy;
import java.net.URL;
import java.util.List;
import java.util.Map;

public class testDemo {

    public static void main(String[] args) throws Exception {
        String url = "https://localhost:8088";
//        url = "https://www.baidu.com";
        String res = sendGetRequest(url,null);
        System.out.println(res);
    }

    public static String sendGetRequest(String url, String cookie) throws Exception{
        SslUtils.ignoreSsl();

        HttpURLConnection httpURLConnection = null;
        HttpURLConnection.setFollowRedirects(false);
        URL u = new URL(url);
        // 走代理
        Proxy proxy = new Proxy(Proxy.Type.HTTP,new InetSocketAddress("127.0.0.1",7890));
        httpURLConnection = (HttpURLConnection) u.openConnection(proxy);

        httpURLConnection.setRequestMethod("GET");
        httpURLConnection.setConnectTimeout(5);
        httpURLConnection.setRequestProperty("User-Agent","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36");
        httpURLConnection.setRequestProperty("Accept", "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9");
//        httpURLConnection.setRequestProperty("Accept-Encoding", "gzip, deflate");
        httpURLConnection.setRequestProperty("Accept-Language", "zh-CN,zh;q=0.9");
        httpURLConnection.setRequestProperty("Connection", "close");
        if (cookie != null){
            httpURLConnection.addRequestProperty("Cookie",cookie);
        }
//        httpURLConnection.connect();

        InputStream inputStream = httpURLConnection.getInputStream();
        BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(inputStream));
        String line= "";
        String res = "";
        while ((line = bufferedReader.readLine()) != null){
            res += line;
            res += "\n";
        }
        return res;
    }
}
